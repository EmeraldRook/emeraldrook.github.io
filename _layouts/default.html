<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ site.title }}</title>
  <meta name="description" content="{{ site.description }}">

  <!-- Theme: prevent FOWT (flash of wrong theme) -->
  <script>
    (function(){
      if (localStorage.getItem('theme') === 'light')
        document.documentElement.setAttribute('data-theme', 'light');
    })();
  </script>

  <!-- Compiled Tailwind CSS -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">

  <!-- Google Fonts: Sora -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-bg font-sans text-text-primary antialiased">

  <!-- Canvas mesh + noise grain — outside hero so GSAP pin transforms don't trap them -->
  <canvas id="hero-canvas" class="fixed inset-0 w-full h-full" style="pointer-events:none;" aria-hidden="true"></canvas>
  <div id="hero-noise" class="fixed inset-0 noise pointer-events-none" aria-hidden="true"></div>

  <a href="#projects" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[60] focus:px-4 focus:py-2 focus:bg-emerald focus:text-black focus:rounded-full">
    Skip to main content
  </a>

  <!-- Assembled nav — starts invisible, populated by hero-to-nav animation -->
  <nav id="assembled-nav" class="fixed top-0 left-0 right-0 z-50 opacity-0 pointer-events-none">
    <div class="max-w-[1400px] mx-auto px-6 md:px-10 lg:px-16">
      <div class="flex items-center justify-between h-16 md:h-20">
        <!-- Left: logo + emerald-textured name -->
        <a href="#hero" class="flex items-center gap-3 group" aria-label="{{ site.company_name }} home">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="w-7 h-7" aria-hidden="true">
            <rect x="4" y="28" width="24" height="3" rx="1" fill="#10B981"/>
            <rect x="6" y="25" width="20" height="3" rx="0.5" fill="#059669"/>
            <polygon points="8,25 10,14 22,14 24,25" fill="#10B981"/>
            <rect x="9" y="11" width="14" height="3" rx="0.5" fill="#059669"/>
            <rect x="9" y="5" width="3" height="6" rx="0.5" fill="#10B981"/>
            <rect x="14.5" y="5" width="3" height="6" rx="0.5" fill="#10B981"/>
            <rect x="20" y="5" width="3" height="6" rx="0.5" fill="#10B981"/>
            <rect x="7" y="3" width="18" height="2" rx="0.5" fill="#059669"/>
          </svg>
          <span class="text-base font-semibold tracking-tight emerald-stone-text">{{ site.company_name }}</span>
        </a>
        <!-- Right: CTA -->
        <a href="mailto:{{ site.company_email }}" class="btn-primary text-sm px-6 py-2.5">
          Get in Touch
        </a>
      </div>
    </div>
  </nav>

  <main>
    {{ content }}
  </main>

  <!-- Vendor Scripts: Lenis + GSAP + ScrollTrigger -->
  <script src="{{ '/assets/js/vendor/lenis.min.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/vendor/gsap.min.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/vendor/ScrollTrigger.min.js' | relative_url }}"></script>

  <script src="{{ '/assets/js/hero-bg.js' | relative_url }}"></script>
  <script src="{{ '/assets/js/main.js' | relative_url }}"></script>

  <!-- Theme toggle button -->
  <button id="theme-toggle" type="button" aria-label="Toggle light and dark theme"
    class="fixed bottom-6 left-6 z-50 flex items-center gap-2 px-4 py-3 min-h-[44px] rounded-full
           bg-bg-elevated/90 backdrop-blur-md border border-border/50
           text-text-secondary hover:text-text-primary
           focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald
           transition-all duration-200 cursor-pointer
           shadow-lg hover:shadow-xl"
    style="font-size: 0.8125rem; font-weight: 500;">
    <!-- Sun icon (shown in dark mode → click to go light) -->
    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3"/>
      <line x1="12" y1="21" x2="12" y2="23"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
      <line x1="1" y1="12" x2="3" y2="12"/>
      <line x1="21" y1="12" x2="23" y2="12"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
    </svg>
    <!-- Moon icon (shown in light mode → click to go dark) -->
    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      style="display:none;">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
    </svg>
    <span id="theme-label">Light</span>
  </button>

  <script>
    (function () {
      var toggle = document.getElementById('theme-toggle');
      var iconSun = document.getElementById('theme-icon-sun');
      var iconMoon = document.getElementById('theme-icon-moon');
      var label = document.getElementById('theme-label');
      var html = document.documentElement;
      var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      function isLight() {
        return html.getAttribute('data-theme') === 'light';
      }

      function syncUI() {
        if (isLight()) {
          iconSun.style.display = 'none';
          iconMoon.style.display = 'block';
          label.textContent = 'Dark';
        } else {
          iconSun.style.display = 'block';
          iconMoon.style.display = 'none';
          label.textContent = 'Light';
        }
      }

      // Sync on load (in case FOWT script already set it)
      syncUI();

      toggle.addEventListener('click', function () {
        var goingLight = !isLight();

        // Enable transition class (skip if reduced motion)
        if (!reducedMotion) {
          html.classList.add('theme-transitioning');
        }

        if (goingLight) {
          html.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
        } else {
          html.removeAttribute('data-theme');
          localStorage.removeItem('theme');
        }

        syncUI();

        // Dispatch event for canvas and other listeners
        window.dispatchEvent(new CustomEvent('themechange', {
          detail: { theme: goingLight ? 'light' : 'dark' }
        }));

        // Remove transition class after animation completes
        if (!reducedMotion) {
          setTimeout(function () {
            html.classList.remove('theme-transitioning');
          }, 450);
        }
      });
    })();
  </script>
</body>
</html>
